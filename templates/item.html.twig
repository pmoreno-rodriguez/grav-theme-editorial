{% extends 'partials/base.html.twig' %}

{% set blog = page.find(header_var('blog_url')|defined(theme_var('blog-page'))) %}
{% set new_base_url = blog.url == '/' ? '' : blog.url %}
{% set show_pagination = header_var('content.pagination')|defined(true) %}
{% set show_breadcrumbs = header_var('content.breadcrumbs')|defined(false) %}
{% set show_image = header_var('show_pageimage')|defined(true) %}
{% set image = page.media[header.featured_image] ?: page.media.images|first %}
{% set img_width = header_var('image_width')|default(1000) %}
{% set img_height = header_var('image_height')|default(300) %}
{% set title = page.title|raw %}

{# Support for translate and twig extensions plugins #}
{% set lang = grav.language.getActive ?: grav.config.site.default_lang %}

{% if config.plugins["translate-date"].enabled %}
    {% set datestamp = (page.header.publish_date) ? (page.header.publish_date|td(null, "Y-m-d")) : (page.date|td(null, "Y-m-d")) %}
{% elseif config.plugins["twig-extensions"].enabled %}
    {% set datestamp = (page.header.publish_date) ? (page.header.publish_date|localizeddate('medium', 'none', lang)) : (page.date|localizeddate('medium', 'none', lang)) %}
{% else %}
    {% set datestamp = (page.header.publish_date) ? (page.header.publish_date|date(system.pages.dateformat.short)) : (page.date|date(system.pages.dateformat.short)) %}
{% endif %}

{% block content %}
    <p>
    {% if show_breadcrumbs and config.plugins.breadcrumbs.enabled %}
        {% include 'partials/breadcrumbs.html.twig' %}
    {% endif %}
    </p>
<article itemscope itemtype="http://schema.org/Article">
    <header>
        <h1 itemprop="name headline">{{ page.title }}</h1>
        {% if page.header.subtitle %}<p>{{ page.header.subtitle|raw }}</p>{% endif %}
        <p class="data-post">
        {% if config.plugins.readingtime.enabled %}<small><i class="fas fa-book-reader"></i> {{ page.content|readingtime}}</small>{% endif %}
        
        {% if datestamp %}
        <br><time itemprop="datePublished"><i class="far fa-clock"></i> {{ 'EDITORIAL.ITEM.POSTED_ON'|t }} {{ datestamp }}</time>
        {% endif %}
        {% if page.taxonomy.author %}<br><small itemprop="author" itemscope itemtype="https://schema.org/Person"><i class="fas fa-user"></i>
        {% for author in page.taxonomy.author %}
        <a class="authors" title="{{ 'EDITORIAL.ITEM.SEE_OTHER_POSTS_OF'|t }} {{ (author|capitalize) }}"
        href="{{ new_base_url }}/author{{ config.system.param_sep }}{{ author }}"><span class="name" itemprop="name" rel="author">{{ author|capitalize }}</span>
        </a>
        {% if not loop.last %}, {% endif %}
        {% endfor %}
        </small>{% endif %}
        </p>
        
    </header>
    {% if show_image and image %}
        <span class="image main" itemprop="image">{{ image.cropZoom(img_width, img_height).loading('lazy').html(title,title,'image')|raw }}</span>
    {% endif %}
    <div itemprop="articleBody">
        {{ page.content|raw }}
    </div>
    <p>
        {% if page.taxonomy.tag %}
        <span>
           <i class="fas fa-tags"></i>
            {% for tag in page.taxonomy.tag %}
                <a class="tags" title="{{ 'EDITORIAL.ITEM.SEE_OTHER_POSTS_IN'|t }} {{ (tag|capitalize) }}" 
                href="{{ new_base_url  }}/tag{{ config.system.param_sep }}{{ tag }}" itemprop="url"><span itemprop="keywords">{{ tag|capitalize }}</span></a>
                {% if not loop.last %}, {% endif %}
            {% endfor %}
        </span>
        {% endif %}
        
        {% if page.taxonomy.category %}
        <span>
            <i class="fas fa-link fa-md"></i>
            {% for category in page.taxonomy.category %}
                <a class="tags" title="{{ 'EDITORIAL.ITEM.SEE_OTHER_POSTS_IN'|t }} {{ (category|capitalize) }}"
			    href="{{ new_base_url }}/category{{ config.system.param_sep }}{{ category }}" itemprop="url"><span itemprop="keywords">{{ category|capitalize }}</span></a>
                {% if not loop.last %}, {% endif %}
            {% endfor %}
        </span>
        {% endif %}
        
        {% if page.taxonomy.author %}
        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <i class="fas fa-user fa-md"></i>
            {% for author in page.taxonomy.author %}
                <a class="tags" title="{{ 'EDITORIAL.ITEM.SEE_OTHER_POSTS_OF'|t }} {{ (author|capitalize) }}" 
                href="{{ new_base_url }}/author{{ config.system.param_sep }}{{ author }}" itemprop="url"><span class="name" itemprop="name" rel="author">{{ author|capitalize }}</span>
                {% if not loop.last %}, {% endif %}
            {% endfor %}
        </span>
        {% endif %}
                
    </p>
    {% if show_pagination %}
    <p class="align-center">
        {% if not page.isLast %}
                <a class="button" href="{{ page.prevSibling.url }}"><i class="fas fa-angle-left"></i> {{ 'EDITORIAL.BLOG.PAGINATION.PREV'|t }}</a>
        {% endif %}
        {% if not page.isFirst %}
            <a class="button" href="{{ page.nextSibling.url }}">{{ 'EDITORIAL.BLOG.PAGINATION.NEXT'|t }} <i class="fas fa-angle-right"></i></a>
        {% endif %}
    </p>
    {% endif %}
</article>
{% endblock %}
