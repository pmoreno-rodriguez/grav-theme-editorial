{# ===========================================
   SEO & META TEMPLATE
   =========================================== #}
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

{# -------------------------
   Title
   ------------------------- #}
{% if meta_title %}
<title>{{ meta_title }}</title>
<meta itemprop="name" content="{{ meta_title }}">
<meta property="og:title" content="{{ meta_title }}">
<meta name="twitter:title" content="{{ meta_title }}">
{% endif %}

{# -------------------------
   Canonical & URLs
   ------------------------- #}
{% if canonical_url %}
<link rel="canonical" href="{{ canonical_url }}">
<meta property="og:url" content="{{ canonical_url }}">
<meta name="twitter:url" content="{{ canonical_url }}">
{% endif %}

{# -------------------------
   Description
   ------------------------- #}
{% if meta_description %}
<meta name="description" content="{{ meta_description }}">
<meta property="og:description" content="{{ meta_description }}">
<meta name="twitter:description" content="{{ meta_description }}">
<meta itemprop="description" content="{{ meta_description }}">
{% endif %}

{# -------------------------
   Featured Image
   ------------------------- #}
{% if image %}
<meta property="og:image" content="{{ image.url|e }}">
<meta name="twitter:image" content="{{ image.url|e }}">
<meta itemprop="image" content="{{ image.url|e }}">
{% endif %}

{# -------------------------
   Social Media Defaults
   ------------------------- #}
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">

{# -------------------------
   Structured Data (JSON-LD)
   ------------------------- #}
<script type="application/ld+json">
{{ {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonical_url
  },
  "headline": page_title,
  "image": image ? image.url : '',
  "datePublished": page.date|date('c'),
  "inLanguage": lang,
  "wordCount": page.content|wordcount,
  "author": {
    "@type": "Person",
    "name": page.taxonomy.author[0]
  },
  "description": meta_description
} | json_encode(constant('JSON_UNESCAPED_UNICODE') b-or constant('JSON_UNESCAPED_SLASHES')) | raw }}
</script>

{# -------------------------
 Custom metadata only (excludes common duplicates)
 ------------------------- #}
{% for meta in page.metadata %}
    {% if meta.name and meta.name not in ['description', 'generator', 'viewport', 'author', 'keywords'] %}
<meta name="{{ meta.name|e }}" content="{{ meta.content|e }}">
    {% elseif meta.http_equiv and meta.http_equiv != 'X-UA-Compatible' %}
<meta http-equiv="{{ meta.http_equiv|e }}" content="{{ meta.content|e }}">
    {% elseif meta.property and meta.property not in ['og:title', 'og:description', 'og:image', 'og:url', 'og:type'] %}
<meta property="{{ meta.property|e }}" content="{{ meta.content|e }}">
    {% endif %}
{% endfor %}
